{{ define "title" }}{{ .Title | markdownify }} | {{ .Site.Title }}{{ end }}

{{ define "schema-dot-org" }}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  {{- /* Google recommends the headline be no more than 110 characters */}}
  "headline": "{{ substr .Title 0 110 }}",
  {{- with .Params.images -}}{{ range first 1 . }}
  "image": {
    "@type": "ImageObject",
    "url": "{{ . | absURL }}"
    {{- /* Don't try to get imageConfig if image param is not local */ -}}
    {{- if not (or (hasPrefix . "http://") (hasPrefix . "https://")) -}}
    {{- with (imageConfig (printf "/static/%s" .)) -}}
    ,
    "height": "{{ .Height }}",
    "width": "{{ .Width }}"
    {{- end -}}
    {{ end }}
  },
  {{- end -}}{{ end }}
  "url": "{{ printf "%s" .Permalink }}",
  "wordCount": "{{ .WordCount }}",
  {{- $ISO8601 := "2006-01-02T15:04:05-07:00" }}
  {{- if not .PublishDate.IsZero }}
  "datePublished": {{ .PublishDate.Format $ISO8601 }},
  {{- else }}
  "datePublished": {{ .Date.Format $ISO8601 }},
  {{- end }}
  {{- if not .Lastmod.IsZero }}
  "dateModified": {{ .Lastmod.Format $ISO8601 }},
  {{- end }}
  {{- with .Site.Social.GooglePlus }}
  "publisher": "{{ printf "%s" . }}",
  {{- end }}
  "author": {
    "@type": "Person",
    "name": "{{ .Params.author | default .Site.Params.author }}"
  }
  {{- if or (.Params.keywords) (or (.Params.categories) (.Params.tags)) -}}
  ,
  "keywords": "{{ delimit (union .Params.keywords (union .Params.categories .Params.tags)) ", " }}"
  {{- end }}

  {{- with .Params.description -}}
  ,
  "description": "{{ . }}"
  {{- end }}
}
</script>
{{ end }}

{{ define "main" }}
{{ $dateFormat := default "2 Jan 2006" (index .Site.Params "date_format") }}

<article class="blog-post single">
  <header>
    <h2 class="title" dir="auto">
      <a href="{{ .Permalink }}" target="_self">
        {{ .Title | markdownify }}
      </a>
    </h2>

    <p class="metadata">
      <!-- show metadata on posts -->
      {{ if ne .Params.type "page" }}
        {{ if not .Date.IsZero }}
          <!-- Thanks https://kodify.net/hugo/date-time/relative-age-hugo/ -->
          {{ $ageMonths := div (sub now.Unix .Date.Unix) 2592000 }}
          {{ if gt $ageMonths 11 }}
            <i class="fas fa-exclamation-triangle" title="Keep in mind this article is over a year old!"></i>
          {{ end }}

          Posted on
          <time datetime="{{ .Date.Format "2001-01-01T00:00:00Z00:00" }}">
            {{ .Date.Format $dateFormat }}
          </time>
        {{ end }} <!-- /if not .Date.IsZero -->
        
        {{ if .Site.Params.showAuthor }}
          {{ i18n "authoredBy" }}
          {{ .Params.author | default .Site.Params.author }}
        {{ end }}

        {{ if or (.Params.categories) (.Params.tags) }}
          {{ i18n "postedIn" }}
          {{ partial "meta-terms.html" . }}
        {{ end }}
      {{ end }} <!-- /.type=page -->

      <!-- if lastmod differs to date then show Updated -->
      {{ if and .Params.lastmod (ne .Params.lastmod .Date) }}
        <!-- Show separator on pages which don't have a publishdate -->
        {{ if ne .Params.type "page" }}
          &ndash;
        {{ end }}
        
        Updated 
        <time datetime="{{ .Params.lastmod.Format "2001-01-01T00:00:00Z00:00" }}">
          {{ .Params.lastmod.Format $dateFormat }}
        </time>
      {{ end }}
    </p>
    
  </header>

  <section class="content">
    {{ .Content }}
  </section>

  {{ if .IsTranslated }}
  <h4>{{ i18n "translations" }}</h4>
  <ul>
    {{ range .Translations }}
    <li>
      <a href="{{ .Permalink }}">{{ .Lang }}: {{ .Title }}{{ if .IsPage }}{{ end }}</a>
    </li>
    {{ end }}
  </ul>
  {{ end }}

  <footer>
    {{ if (ne ($.Param "sharingicons") false) }}
      {{ partial "sharing-icons.html" . }}
    {{ end }}

    {{ if and (.Site.DisqusShortname) (ne .Params.comments false) }}
      {{ template "_internal/disqus.html" . }}
    {{ end }}
  </footer>

</article> <!-- /.blog-post -->

{{ end }}
