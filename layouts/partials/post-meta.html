{{ $dateFormat := default "2 Jan 2006" (index .Site.Params "date_format") }}
{{ $dayFormat := default "2" (index .Site.Params "date_format") }}
{{ $monthFormat := default "Jan" (index .Site.Params "date_format") }}
{{ $yearFormat := default "2006" (index .Site.Params "date_format") }}

<h1>
  <a href="{{ .Permalink }}" title="{{ .Title }}" target="_self">
    {{ if .Title }}
      {{ .Title }}
    {{ else }}
      {{ .Date.Format (default "2 Jan 2006" (index .Site.Params "date_format")) }}
    {{ end }}
  </a>
</h1>

<p class="metadata">
    <!-- show metadata on posts -->
    {{ if not .Date.IsZero }}
      {{ if .Params.draft }}
        <span title="Draft / Under construction">
          {{ safeHTML "&#128679;" }}
        </span>
      {{ end }}

      {{ if ne .Params.type "page" }}
        {{ if .Title }} <!-- Hide "posted on" when title is the date -->
          <span>Posted</span>
          <time datetime="{{ .Date.Format "2001-01-01T00:00:00Z00:00" }}">
            {{ .Date.Format $dayFormat | humanize }}
            {{ .Date.Format $monthFormat }}
            {{ .Date.Format $yearFormat }}
          </time>
        {{ end }} <!-- /if not .Title -->
      {{ end }} <!-- /if not .Date.IsZero -->
      
      {{ if .Site.Params.showAuthor }}
        {{ i18n "authoredBy" }}
        {{ .Params.author | default .Site.Params.author }}
      {{ end }}

      {{ if or (.Params.categories) (.Params.tags) }}
        {{ i18n "postedIn" }}
        {{ partial "meta-terms.html" . }}
      {{ end }}
    {{ end }} <!-- /.type!=page -->

    <!-- if lastmod differs to date then show Updated -->
    {{ if (and .Params.lastmod (or (ne .Params.lastmod .Date) (eq .Params.type "page"))) }}
      <!-- Show separator on pages which don't have a publishdate -->
      {{ if ne .Params.type "page" }}
        &ndash;
      {{ end }} <!-- /.type!=page -->
      
      <span>Updated</span>
      <time datetime="{{ .Params.lastmod.Format "2001-01-01T00:00:00Z00:00" }}">
        {{ .Params.lastmod.Format $dayFormat | humanize }}
        {{ .Params.lastmod.Format $monthFormat }}
        {{ .Params.lastmod.Format $yearFormat }}
      </time>
    {{ end }}

    <!-- if .Date or .Params.lastmod is over a year old -->
    {{ $pageAge := .Date }}
    {{ if .Params.lastmod }}
      {{ $pageAge := . }}
    {{ end }}

    <!-- Thanks https://kodify.net/hugo/date-time/relative-age-hugo/ -->
    {{ $ageMonths := div (sub now.Unix $pageAge.Unix) 2592000 }}
    {{ if (eq .Type "posts") }}
      {{ if gt $ageMonths 11 }}
        <i class="fas fa-exclamation-triangle {{ if gt $ageMonths 23 }}text-orange{{ else }}text-info{{ end }}" title="Keep in mind this article is over a year old!"></i>
      {{ end }}
    {{ end }} <!-- /.type!=page -->
</p>